"use strict";var highCharts2Image=function highCharts2Image(options){return new Promise(function(resolve,reject){var pseudoGuid=function pseudoGuid(){var fourChars=function fourChars(){return((1+Math.random())*65536|0).toString(16).substring(1).toUpperCase()};return fourChars()+fourChars()+"-"+fourChars()+"-"+fourChars()+"-"+fourChars()+"-"+fourChars()+fourChars()+fourChars()};var opts=Object.assign({chartEngine:"highcharts",chartEngineVersion:"5.0.7",chartCallback:function chartCallback(chart){},iframeId:pseudoGuid(),width:600,height:400},options);var chartEngine=opts.chartEngine,chartOptions=opts.chartOptions,chartEngineVersion=opts.chartEngineVersion,chartCallback=opts.chartCallback,iframeId=opts.iframeId,width=opts.width,height=opts.height;var exitGracefully=function exitGracefully(msg,isRejected){window.removeEventListener("message",onmessage);var hc2imageFrame=window.document.getElementById(iframeId);hc2imageFrame.parentElement.removeChild(hc2imageFrame);return isRejected?reject(msg):resolve(msg)};var distroUrl="https://cdnjs.cloudflare.com/ajax/libs/highcharts";var distroObj={highcharts:distroUrl+"/"+chartEngineVersion+"/highcharts.js",highstock:distroUrl+"/"+chartEngineVersion+"/highstock.js",exporting:distroUrl+"/"+chartEngineVersion+"/js/modules/exporting.js",offlineExporting:distroUrl+"/"+chartEngineVersion+"/js/modules/offline-exporting.js"};var chartMethodObj={highcharts:"chart",highstock:"stockChart"};var injectr=function injectr(doc,srcList){if(srcList.length===0)return;var script=doc.createElement("script");script.type="text/javascript";var source=srcList[0];var srcListNew=srcList.slice(1);script.onload=function(e){return injectr(doc,srcListNew)};script.onerror=function(e){return exitGracefully("Error: can't load script: "+source.src,true)};if(source.src)script.src=source.src;else if(source.text)script.textContent=source.text;else return;doc.body.appendChild(script)};var fillFrame=function fillFrame(){var payloadFn=function(){var win=window.frames.parent;var postBack=function postBack(png,errMsg){return win.postMessage({from:"$FRAMEID",png:png,errMsg:errMsg},"*")};var getImageFromSVG=function getImageFromSVG(svg){return Highcharts.imageToDataUrl(Highcharts.svgToDataUrl(svg),"image/png",{},1,postBack)};try{var _options=Object.assign($OPTIONS,{chart:{renderTo:"container"}});var chart=new Highcharts.$CHARTMETHOD(_options);var cbResult=$CALLBACK(chart);chart.getSVGForLocalExport(null,null,null,getImageFromSVG)}catch(err){postBack(null,err.toString())}}.toString().replace("$FRAMEID",iframeId).replace("$OPTIONS",JSON.stringify(chartOptions)).replace("$CHARTMETHOD",chartMethodObj[chartEngine.toLowerCase()]).replace("$CALLBACK",chartCallback.toString());var HTMLMarkup="\n          <div id=\"container\" style=\"width: "+width+"px; height: "+height+"px;\"></div>\n        ";var payloadJS="\n          eval( ("+payloadFn+")() )\n        ";var injScriptList=[{src:distroObj[chartEngine.toLowerCase()]},{src:distroObj.exporting},{src:distroObj.offlineExporting},{text:payloadJS}];var doc=window.frames[iframeId].document;doc.body.insertAdjacentHTML("beforeend",HTMLMarkup);injectr(doc,injScriptList)};var iframe=document.createElement("iframe");iframe.id=iframeId;iframe.name=iframeId;iframe.style="width: 1px; height: 1px; visibility: hidden;";iframe.onload=fillFrame;document.body.appendChild(iframe);var onmessage=function onmessage(message){var _message$data=message.data,from=_message$data.from,png=_message$data.png,errMsg=_message$data.errMsg;if(from!==iframeId)return;return png!==null?exitGracefully(png):exitGracefully(errMsg,true)};window.addEventListener("message",onmessage)})};window.highCharts2Image=highCharts2Image;
