"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var highCharts2Image=function highCharts2Image(options){return new Promise(function(resolve,reject){var pseudoGuid=function pseudoGuid(){var fourChars=function fourChars(){return((1+Math.random())*65536|0).toString(16).substring(1).toUpperCase()};return fourChars()+fourChars()+"-"+fourChars()+"-"+fourChars()+"-"+fourChars()+"-"+fourChars()+fourChars()+fourChars()};var opts=Object.assign({chartEngine:"highcharts",chartEngineVersion:"5.0.9",chartCallback:function chartCallback(chart){return chart.redraw()},width:600,height:400},options);var chartOptions=opts.chartOptions,chartEngine=opts.chartEngine,chartEngineVersion=opts.chartEngineVersion,chartCallback=opts.chartCallback,distro=opts.distro,width=opts.width,height=opts.height;var cdn="https://cdnjs.cloudflare.com/ajax/libs/highcharts";var defaultDistroObj={highcharts:cdn+"/"+chartEngineVersion+"/highcharts.js",highstock:cdn+"/"+chartEngineVersion+"/highstock.js",exporting:cdn+"/"+chartEngineVersion+"/js/modules/exporting.js",offlineExporting:cdn+"/"+chartEngineVersion+"/js/modules/offline-exporting.js"};var distroObj=Object.assign(defaultDistroObj,distro);var iframeId=pseudoGuid();var strChartOptions=JSON.stringify(chartOptions);var exitGracefully=function exitGracefully(msg,isRejected){window.removeEventListener("message",onmessage);document.body.removeChild(iframe);return isRejected?reject(msg):resolve(msg)};var chartMethodObj={highcharts:"chart",highstock:"stockChart"};var injectr=function injectr(doc,srcList,cb){if(srcList.length===0)return cb?cb():false;var script=doc.createElement("script");script.type="text/javascript";var source=srcList[0];var srcListNew=srcList.slice(1);var addRemoteScript=function addRemoteScript(target,src){target.onload=function(e){return injectr(doc,srcListNew,cb)};target.onerror=function(e){return exitGracefully("Error: can't load script: "+src.src,true)};target.src=src.src;doc.body.appendChild(target)};var addTextScript=function addTextScript(target,src){target.textContent=src.text;doc.body.appendChild(target);injectr(doc,srcListNew,cb)};if(source.src)return addRemoteScript(script,source);else if(source.text)return addTextScript(script,source);else return injectr(doc,srcListNew,cb)};var payloadFn=function payloadFn(innerWin){var parentWin=window.frames.parent;var postBack=function postBack(png,errMsg){return parentWin.postMessage({from:innerWin.FRAMEID,png:png,errMsg:errMsg},"*")};var getImageFromSVG=function getImageFromSVG(svg){return innerWin.Highcharts.imageToDataUrl(innerWin.Highcharts.svgToDataUrl(svg),"image/png",{},1,postBack)};try{var hc2i=function hc2i(){return this.getSVGForLocalExport(null,null,null,getImageFromSVG)};var _options=Object.assign(JSON.parse(innerWin.CHARTOPTIONS),{chart:{renderTo:"container",events:{redraw:hc2i}}});var chart=new innerWin.Highcharts[innerWin.CHARTMETHOD](_options);{innerWin.CALLBACK(chart,innerWin)}}catch(err){postBack(null,err.toString())}};var payloadJS="\n        PAYLOAD(window)\n      ";var fillFrame=function fillFrame(){var iframeWin=iframe.contentWindow||iframe;iframeWin.FRAMEID=iframeId;iframeWin.CHARTOPTIONS=strChartOptions;iframeWin.CHARTMETHOD=chartMethodObj[chartEngine.toLowerCase()];iframeWin.CALLBACK=chartCallback;iframeWin.PAYLOAD=payloadFn;var HTMLMarkup="\n          <div id=\"container\" style=\"width: "+width+"px; height: "+height+"px;\"></div>\n        ";var generateScriptList=function generateScriptList(){var blacklist=["highcharts","highstock","exporting","offlineExporting"];var addCustomScripts=function addCustomScripts(){return Object.keys(distroObj).filter(function(libName){return!blacklist.includes(libName)}).map(function(libName){return{src:distroObj[libName]}})};return[{src:distroObj[chartEngine.toLowerCase()]},{src:distroObj.exporting},{src:distroObj.offlineExporting}].concat(_toConsumableArray(addCustomScripts()),[{text:payloadJS}])};var injScriptList=generateScriptList();var doc=iframe.contentDocument;doc.body.insertAdjacentHTML("beforeend",HTMLMarkup);injectr(doc,injScriptList)};var iframe=document.createElement("iframe");iframe.style="width: 1px; height: 1px; visibility: hidden;";iframe.onload=fillFrame;document.body.appendChild(iframe);var onmessage=function onmessage(message){var _message$data=message.data,from=_message$data.from,png=_message$data.png,errMsg=_message$data.errMsg;if(from!==iframeId)return;return png!==null?exitGracefully(png):exitGracefully(errMsg,true)};window.addEventListener("message",onmessage)})};window.highCharts2Image=highCharts2Image;
